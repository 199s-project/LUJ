	<!DOCTYPE html>
<html>
<head>

<body>
    <h1 style="text-align: center;">Table with Details View</h1>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Age</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <tr data-id="1" data-name="Alice" data-age="25">
                <td>1</td>
                <td>Alice</td>
                <td>25</td>
                <td><button class="details-btn">Details</button></td>
            </tr>
            <tr data-id="2" data-name="Bob" data-age="30">
                <td>2</td>
                <td>Bob</td>
                <td>30</td>
                <td><button class="details-btn">Details</button></td>
            </tr>
            <tr data-id="3" data-name="Charlie" data-age="35">
                <td>3</td>
                <td>Charlie</td>
                <td>35</td>
                <td><button class="details-btn">Details</button></td>
            </tr>
        </tbody>
    </table>

    <div class="details" id="details-view">
        <h3>Details:</h3>
        <p><strong>ID:</strong> <span id="detail-id"></span></p>
        <p><strong>Name:</strong> <span id="detail-name"></span></p>
        <p><strong>Age:</strong> <span id="detail-age"></span></p>
        <button onclick="closeDetails()">Close</button>
    </div>

<script>

public int addRecipe(@RequestParam Map<String,Object> map) throws Exception {
	
	String product_code = (String)map.get("recipe-input1");
	System.out.println(product_code);
	String product_code_replaced = product_code.replaceAll("\\(.*\\)$", "");
	System.out.println(product_code_replaced);
	RecipeVO recipeVO = new RecipeVO();
	recipeVO.setProduct_name((String)map.get("recipe-input2"));
	recipeVO.setProduct_code(product_code_replaced);
	recipeVO.setRecipe_price(Integer.parseInt((String) map.get("recipe-input3")));
	
	int result = projectDAO.insertRecipe(recipeVO);
	
	int product_num = projectDAO.getProductNumByProductCode(product_code_replaced);
	int LastRecipeNum = projectDAO.getLastRecipeNum();
	int i = 1;
	
	for (;;) {
		String a = "material-name-input" + i;
		String b = "material-amount-input" + i;
		i += 1;
		RecipeDetailVO recipeDetailVO = new RecipeDetailVO();
		String material_name = (String)(map.get(a));
		int material_amount = Integer.parseInt((String)(map.get(b)));
		
		if(material_name == "") {
			continue;
		}
		if(material_amount == 0) {
			continue;
		}
		
		recipeDetailVO.setRecipe_num(LastRecipeNum);
		recipeDetailVO.setProduct_num(product_num);
		recipeDetailVO.setMaterial_name(material_name);
		recipeDetailVO.setMaterial_amount(material_amount);
		
		System.out.println(recipeDetailVO);
		
		int result2 = projectDAO.insertRecipeDetail(recipeDetailVO);
	}
}




function addrecipe() {
	Swal.fire({
		html: `
			<table id="register-table" class="register-table input-auto-size">
				<thead>
					<tr>
						<td colspan="2" style="text-align:left"> 
							<div class="table-title"><i class="fa-solid fa-gift"></i> &nbsp; 레시피 정보 등록 </div> 
						<td>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td class="heading-td"> 제품코드 </td>
						<td> <input id="recipe-input1" class="swal2-input" placeholder="제품코드" autocomplete="new-password" onclick="productcodeAutocomplete()" onblur="product_codeValidation()" required> <input id="product-code-validation-result" class="swal2-input product-code-result" readonly placeholder="사용가능여부"> </td>
					</tr>
					<tr>
						<td class="heading-td"> 제품명 </td>
						<td> <input id="recipe-input2" class="swal2-input" placeholder="제품명" autocomplete="new-password" readonly> </td>
					</tr>
					<tr>
						<td class="heading-td"> 생산단가 </td>
						<td> <input id="recipe-input3" class="swal2-input" placeholder="생산단가" autocomplete="new-password" required> </td>
					</tr>
					<tr>
						<td class="heading-td">열 추가/삭제</td>
						<td class="btn-td">
						<button type="button" class="btn btn-primary m-2 rowbtn" onclick="addrow()">열 추가</button>
			        	<button type="button" class="btn btn-primary m-2 rowbtn" onclick="deleterow()">열 제거</button>
						</td>
			        </tr>
					<tr>
						<td class="heading-td"> 레시피1 </td>
						<td> <input type="text" id="material-name-input1" class="swal2-input material-name-input" placeholder="레시피 종류" autocomplete="off" required onblur="rowmaterialChange(event)"> <input type="text" id="material-amount-input1" class="swal2-input material-amount-input" placeholder="레시피 수량" autocomplete="new-password" required></td>
					</tr>            
				</tbody>
			</table>
		`,
		showCancelButton: true,
		confirmButtonColor: "#2BC783",
		cancelButtonColor: "#d33",
		confirmButtonText: "Submit",
		cancelButtonText: "Cancel",
		allowOutsideClick: false,
		focusConfirm: false,
		preConfirm: () => {
			const formElements = document.querySelectorAll('#register-table input');
			const codevalidation = document.querySelector('#product-code-validation-result');
			const codevalue = codevalidation.value;
			const formData = new Map();
			let isValid = true; // 입력 값 검증 상태
			
			if (codevalue === "사용불가") {
				isValid = false;
			} else {
				isValid = true;
			}
			
			formElements.forEach(input => {
				const value = input.value.trim(); // 값 확인
				if (!value && input.required) { // 값이 없는 경우
					isValid = false;
					input.style.borderColor = "red"; // 경고
					input.focus(); // 필드로 포커스 변경
				} else {
					input.style.borderColor = ""; // 경고제거
					formData.set(input.id, value);
				}
			});
	      
			if (!isValid) {
				Swal.showValidationMessage("입력란을 채워주세요.")
				return false;
			}
			
			return Object.fromEntries(formData);
		},
	})
	.then((result) => {
		if (result.isConfirmed) {
			fetch(`/addRecipe`, {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				},
				body: JSON.stringify(result.value),
			})
			.then(response => {
				if (!response.ok) {
					throw new Error(`Error: 다시해~!`);
				}
				return response.json();
			})
			.then(data => {
				Swal.fire("성공", "레시피 정보 추가완료", "success");
			})
			.catch(error=> {
				console.error('Error:', error);
				Swal.fire("오류", error.message, "error");
			});
		}
		count = 2;
	});
}



</script>










<script>



</script>






</head>
<body>











	<!-- js -->
	<script src="vendors/scripts/core.js"></script>
	<script src="vendors/scripts/script.min.js"></script>
	<script src="vendors/scripts/process.js"></script>
	<script src="vendors/scripts/layout-settings.js"></script>
	<script src="src/plugins/datatables/js/jquery.dataTables.min.js"></script>
	<script src="src/plugins/datatables/js/dataTables.bootstrap4.min.js"></script>
	<script src="src/plugins/datatables/js/dataTables.responsive.min.js"></script>
	<script src="src/plugins/datatables/js/responsive.bootstrap4.min.js"></script>
	<!-- buttons for Export datatable -->
	<script src="src/plugins/datatables/js/dataTables.buttons.min.js"></script>
	<script src="src/plugins/datatables/js/buttons.bootstrap4.min.js"></script>
	<script src="src/plugins/datatables/js/buttons.print.min.js"></script>
	<script src="src/plugins/datatables/js/buttons.html5.min.js"></script>
	<script src="src/plugins/datatables/js/buttons.flash.min.js"></script>
	<script src="src/plugins/datatables/js/pdfmake.min.js"></script>
	<script src="src/plugins/datatables/js/vfs_fonts.js"></script>
	<!-- Datatable Setting js -->
	<script src="vendors/scripts/datatable-setting.js"></script>
	
	<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	<script>

	</script>
	
	</body>

</html>